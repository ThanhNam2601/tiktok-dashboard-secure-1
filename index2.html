<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Balance Management Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #ff0050;
            --secondary-color: #00f2ea;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --border-color: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark-color);
        }

        /* ===== LOGIN STYLES ===== */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            width: 100%;
            max-width: 400px;
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .login-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-logo {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 16px;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: #6b7280;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: all 0.2s;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 0, 80, 0.1);
        }

        .form-input.error {
            border-color: var(--danger-color);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .password-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            padding: 4px;
        }

        .password-toggle:hover {
            color: var(--primary-color);
        }

        .login-button {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 16px;
        }

        .login-button:hover {
            background: #e6004a;
            transform: translateY(-1px);
        }

        .login-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .remember-me input {
            margin-right: 8px;
        }

        .remember-me label {
            font-size: 14px;
            color: #6b7280;
            cursor: pointer;
        }

        /* ===== DASHBOARD STYLES ===== */
        .dashboard-container {
            display: none;
        }

        .dashboard-container.active {
            display: block;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header-left h1 {
            color: var(--primary-color);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header-info {
            display: flex;
            gap: 16px;
            font-size: 14px;
            font-weight: 500;
            flex-wrap: wrap;
        }

        .account-stat {
            padding: 8px 12px;
            border-radius: 6px;
            background: var(--light-color);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        .user-role {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
        }

        .logout-btn {
            padding: 8px 16px;
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-color);
        }

        .stat-card.success::before { background: var(--success-color); }
        .stat-card.warning::before { background: var(--warning-color); }
        .stat-card.info::before { background: var(--secondary-color); }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .stat-title {
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            text-transform: uppercase;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 14px;
            font-weight: 500;
        }

        .stat-change.positive { color: var(--success-color); }
        .stat-change.negative { color: var(--danger-color); }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .nav-tab {
            padding: 12px 24px;
            border: none;
            background: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: var(--light-color);
        }

        .nav-tab.hidden {
            display: none;
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Accounts Grid */
        .seller-section {
            margin-bottom: 32px;
        }

        .seller-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
        }

        .seller-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .seller-stats {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: #6b7280;
        }

        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .account-card {
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }

        .account-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.15);
        }

        .account-card.status-active {
            border-color: var(--success-color);
            background: #f0fdf4;
        }

        .account-card.status-warning {
            border-color: var(--warning-color);
            background: #fffbeb;
        }

        .account-card.status-error {
            border-color: var(--danger-color);
            background: #fef2f2;
        }

        .account-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .account-name {
            font-weight: 600;
            font-size: 16px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-indicator.active { background: var(--success-color); }
        .status-indicator.warning { background: var(--warning-color); }
        .status-indicator.error { background: var(--danger-color); }

        .account-balance {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .balance-item {
            text-align: center;
            padding: 8px;
            border-radius: 4px;
            background: white;
        }

        .balance-label {
            font-size: 11px;
            color: #6b7280;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .balance-value {
            font-weight: 600;
            font-size: 14px;
        }

        .account-orders {
            text-align: center;
            padding: 8px;
            background: var(--light-color);
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
        }

        .account-updated {
            font-size: 12px;
            color: #9ca3af;
            text-align: center;
            margin-top: 8px;
        }

        /* FFM Input Section */
        .ffm-search {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            border-color: var(--primary-color);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .btn.success {
            background: var(--success-color);
            color: white;
        }

        .btn.secondary {
            background: #6b7280;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .ffm-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 24px;
        }

        .ffm-table th,
        .ffm-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .ffm-table th {
            background: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
        }

        .ffm-input {
            width: 100px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: right;
        }

        .profit-cell {
            font-weight: 600;
        }

        .profit-positive { color: var(--success-color); }
        .profit-negative { color: var(--danger-color); }

        /* Reports Section */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--dark-color);
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .report-table th,
        .report-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .report-table th {
            background: var(--light-color);
            font-weight: 600;
        }

        /* Settings Section */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .settings-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .settings-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--dark-color);
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            outline: none;
        }

        /* User Management Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        .user-list {
            margin-bottom: 20px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .user-item-info {
            flex: 1;
        }

        .user-item-name {
            font-weight: 500;
        }

        .user-item-role {
            font-size: 12px;
            color: #6b7280;
        }

        .delete-user-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Status badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.success {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.error {
            background: #f8d7da;
            color: #721c24;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: var(--success-color); }
        .notification.error { background: var(--danger-color); }
        .notification.info { background: var(--secondary-color); }

        /* Responsive */
        @media (max-width: 768px) {
            .login-card {
                padding: 24px;
                margin: 16px;
            }

            .container {
                padding: 12px;
            }

            .header {
                flex-direction: column;
                text-align: center;
            }

            .header-info {
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 2rem;
            }

            .accounts-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 12px;
            }

            .nav-tabs {
                padding: 4px;
            }

            .nav-tab {
                padding: 8px 16px;
                font-size: 14px;
            }

            .ffm-search {
                flex-direction: column;
            }

            .search-input {
                min-width: auto;
            }

            .reports-grid {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fab fa-tiktok"></i>
                </div>
                <h1 class="login-title">TikTok Balance Dashboard</h1>
                <p class="login-subtitle">Đăng nhập để truy cập hệ thống quản lý</p>
            </div>

            <form id="loginForm">
                <div id="errorMessage" class="error-message" style="display: none;"></div>
                
                <div class="form-group">
                    <label class="form-label" for="username">Tên đăng nhập</label>
                    <input type="text" id="username" class="form-input" required autocomplete="username">
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Mật khẩu</label>
                    <div class="password-container">
                        <input type="password" id="password" class="form-input" required autocomplete="current-password">
                        <button type="button" class="password-toggle" onclick="togglePassword()">
                            <i class="fas fa-eye" id="passwordIcon"></i>
                        </button>
                    </div>
                </div>

                <div class="remember-me">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe">Ghi nhớ đăng nhập</label>
                </div>

                <button type="submit" class="login-button">
                    <i class="fas fa-sign-in-alt"></i> Đăng nhập
                </button>
            </form>

            <div style="text-align: center; margin-top: 20px; font-size: 12px; color: #6b7280;">
                Demo accounts: admin/admin123, november_chi/123
            </div>
        </div>
    </div>

    <!-- DASHBOARD SCREEN -->
    <div id="dashboardScreen" class="dashboard-container">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <h1><i class="fab fa-tiktok"></i> TikTok Balance Management Dashboard</h1>
                    <div class="header-info">
                        <div class="account-stat">
                            <i class="fas fa-clock"></i> Cập nhật: <span id="lastUpdate">22/06/2025 - 23:37</span>
                        </div>
                        <div class="account-stat">
                            <i class="fas fa-store"></i> Tổng tài khoản: <strong>50</strong>
                        </div>
                        <div class="account-stat">
                            <i class="fas fa-check-circle" style="color: var(--success-color);"></i> Hoạt động: <strong>48</strong>
                        </div>
                        <div class="account-stat">
                            <i class="fas fa-exclamation-triangle" style="color: var(--danger-color);"></i> Offline: <strong>2</strong>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <div class="user-name" id="currentUserName">Administrator</div>
                        <div class="user-role" id="currentUserRole">ADMIN</div>
                    </div>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Đăng xuất
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card success">
                    <div class="stat-header">
                        <div class="stat-title">Tổng Paid</div>
                        <div class="stat-icon" style="background: var(--success-color);">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value">$12,450</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> +5% so với hôm qua
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-header">
                        <div class="stat-title">Tổng Processing</div>
                        <div class="stat-icon" style="background: var(--warning-color);">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="stat-value">$8,230</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i> -2% so với hôm qua
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-header">
                        <div class="stat-title">Tổng On Hold</div>
                        <div class="stat-icon" style="background: var(--secondary-color);">
                            <i class="fas fa-pause"></i>
                        </div>
                    </div>
                    <div class="stat-value">$45,670</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> +12% so với hôm qua
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Chi phí Ads</div>
                        <div class="stat-icon" style="background: var(--primary-color);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value">$2,340</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i> +8% so với hôm qua
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('overview')">
                    <i class="fas fa-chart-pie"></i> Tổng quan
                </button>
                <button class="nav-tab" onclick="switchTab('trang')" id="tab-trang">
                   <i class="fas fa-user"></i> Seller Trang
               </button>
               <button class="nav-tab" onclick="switchTab('phuong')" id="tab-phuong">
                   <i class="fas fa-user"></i> Seller Phượng
               </button>
               <button class="nav-tab" onclick="switchTab('chi')" id="tab-chi">
                   <i class="fas fa-user"></i> Seller Chi
               </button>
               <button class="nav-tab" onclick="switchTab('ffm')" id="tab-ffm">
                   <i class="fas fa-calculator"></i> Nhập FFM
               </button>
               <button class="nav-tab" onclick="switchTab('reports')" id="tab-reports">
                   <i class="fas fa-chart-bar"></i> Báo cáo
               </button>
               <button class="nav-tab" onclick="switchTab('settings')" id="tab-settings">
                   <i class="fas fa-cog"></i> Cài đặt
               </button>
               <button class="nav-tab" onclick="openUserManagement()" id="tab-users" style="display: none;">
                   <i class="fas fa-users"></i> Quản lý Users
               </button>
           </div>

           <!-- Overview Section -->
           <div id="overview-section" class="content-section active">
               <div class="section-content">
                   <!-- Seller Trang -->
                   <div class="seller-section">
                       <div class="seller-header">
                           <div class="seller-title">
                               <i class="fas fa-crown" style="color: #fbbf24;"></i> SELLER TRANG
                           </div>
                           <div class="seller-stats">
                               <span><i class="fas fa-store"></i> 12 tài khoản</span>
                               <span><i class="fas fa-shopping-cart"></i> 34 đơn hôm nay</span>
                               <span><i class="fas fa-dollar-sign"></i> $1,245 doanh thu</span>
                           </div>
                       </div>
                       <div class="accounts-grid" id="trangAccounts">
                           <!-- Accounts sẽ được tạo bằng JavaScript -->
                       </div>
                   </div>

                   <!-- Seller Phượng -->
                   <div class="seller-section">
                       <div class="seller-header">
                           <div class="seller-title">
                               <i class="fas fa-gem" style="color: #8b5cf6;"></i> SELLER PHƯỢNG
                           </div>
                           <div class="seller-stats">
                               <span><i class="fas fa-store"></i> 10 tài khoản</span>
                               <span><i class="fas fa-shopping-cart"></i> 28 đơn hôm nay</span>
                               <span><i class="fas fa-dollar-sign"></i> $987 doanh thu</span>
                           </div>
                       </div>
                       <div class="accounts-grid" id="phuongAccounts">
                           <!-- Accounts sẽ được tạo bằng JavaScript -->
                       </div>
                   </div>

                   <!-- Seller Chi -->
                   <div class="seller-section">
                       <div class="seller-header">
                           <div class="seller-title">
                               <i class="fas fa-star" style="color: #06b6d4;"></i> SELLER CHI
                           </div>
                           <div class="seller-stats">
                               <span><i class="fas fa-store"></i> 10 tài khoản</span>
                               <span><i class="fas fa-shopping-cart"></i> 31 đơn hôm nay</span>
                               <span><i class="fas fa-dollar-sign"></i> $1,156 doanh thu</span>
                           </div>
                       </div>
                       <div class="accounts-grid" id="chiAccounts">
                           <!-- Accounts sẽ được tạo bằng JavaScript -->
                       </div>
                   </div>
               </div>
           </div>

           <!-- Individual Seller Sections -->
           <div id="trang-section" class="content-section">
               <div class="section-content">
                   <div class="seller-header">
                       <div class="seller-title">
                           <i class="fas fa-crown" style="color: #fbbf24;"></i> CHI TIẾT SELLER TRANG
                       </div>
                       <div class="seller-stats">
                           <span><i class="fas fa-calendar"></i> Tuần này: 127 đơn</span>
                           <span><i class="fas fa-dollar-sign"></i> Doanh thu: $2,534</span>
                           <span><i class="fas fa-chart-line"></i> Lợi nhuận: $1,643</span>
                       </div>
                   </div>
                   <div class="accounts-grid" id="trangDetailAccounts">
                       <!-- Chi tiết accounts của Trang -->
                   </div>
               </div>
           </div>

           <div id="phuong-section" class="content-section">
               <div class="section-content">
                   <div class="seller-header">
                       <div class="seller-title">
                           <i class="fas fa-gem" style="color: #8b5cf6;"></i> CHI TIẾT SELLER PHƯỢNG
                       </div>
                       <div class="seller-stats">
                           <span><i class="fas fa-calendar"></i> Tuần này: 98 đơn</span>
                           <span><i class="fas fa-dollar-sign"></i> Doanh thu: $1,976</span>
                           <span><i class="fas fa-chart-line"></i> Lợi nhuận: $1,284</span>
                       </div>
                   </div>
                   <div class="accounts-grid" id="phuongDetailAccounts">
                       <!-- Chi tiết accounts của Phượng -->
                   </div>
               </div>
           </div>

           <div id="chi-section" class="content-section">
               <div class="section-content">
                   <div class="seller-header">
                       <div class="seller-title">
                           <i class="fas fa-star" style="color: #06b6d4;"></i> CHI TIẾT SELLER CHI
                       </div>
                       <div class="seller-stats">
                           <span><i class="fas fa-calendar"></i> Tuần này: 119 đơn</span>
                           <span><i class="fas fa-dollar-sign"></i> Doanh thu: $2,387</span>
                           <span><i class="fas fa-chart-line"></i> Lợi nhuận: $1,553</span>
                       </div>
                   </div>
                   <div class="accounts-grid" id="chiDetailAccounts">
                       <!-- Chi tiết accounts của Chi -->
                   </div>
               </div>
           </div>

           <!-- FFM Input Section -->
           <div id="ffm-section" class="content-section">
               <div class="section-content">
                   <h2 class="chart-title">
                       <i class="fas fa-calculator"></i> Nhập Fulfillment Cost (FFM)
                   </h2>
                   
                   <div class="ffm-search">
                       <input type="text" class="search-input" placeholder="Tìm kiếm theo mã đơn, tài khoản, ngày..." id="orderSearch">
                       <button class="btn primary" onclick="searchOrders()">
                           <i class="fas fa-search"></i> Tìm kiếm
                       </button>
                       <button class="btn secondary" onclick="importFromExcel()">
                           <i class="fas fa-file-excel"></i> Import Excel
                       </button>
                   </div>

                   <div style="overflow-x: auto;">
                       <table class="ffm-table">
                           <thead>
                               <tr>
                                   <th>Ngày</th>
                                   <th>Tài khoản</th>
                                   <th>Mã đơn hàng</th>
                                   <th>Tên sản phẩm</th>
                                   <th>Giá trị đơn</th>
                                   <th>FFM Cost</th>
                                   <th>Lợi nhuận</th>
                                   <th>Trạng thái</th>
                               </tr>
                           </thead>
                           <tbody id="ffmTableBody">
                               <!-- Data sẽ được load bằng JavaScript -->
                           </tbody>
                       </table>
                   </div>

                   <div style="margin-top: 24px; display: flex; gap: 16px; justify-content: flex-end; flex-wrap: wrap;">
                       <button class="btn success" onclick="saveAllFFM()">
                           <i class="fas fa-save"></i> Lưu tất cả
                       </button>
                       <button class="btn secondary" onclick="exportFFMData()">
                           <i class="fas fa-download"></i> Xuất Excel
                       </button>
                   </div>
               </div>
           </div>

           <!-- Reports Section -->
           <div id="reports-section" class="content-section">
               <div class="section-content">
                   <h2 class="chart-title">
                       <i class="fas fa-chart-bar"></i> Báo cáo & Phân tích
                   </h2>

                   <div class="reports-grid">
                       <!-- Weekly Performance Chart -->
                       <div class="chart-container">
                           <h3 class="chart-title">Hiệu suất tuần (7 ngày qua)</h3>
                           <canvas id="weeklyChart"></canvas>
                       </div>

                       <!-- Seller Comparison Chart -->
                       <div class="chart-container">
                           <h3 class="chart-title">So sánh Seller</h3>
                           <canvas id="sellerChart"></canvas>
                       </div>

                       <!-- Monthly Trends -->
                       <div class="chart-container">
                           <h3 class="chart-title">Xu hướng tháng</h3>
                           <canvas id="monthlyChart"></canvas>
                       </div>

                       <!-- Top Accounts -->
                       <div class="chart-container">
                           <h3 class="chart-title">Top 10 tài khoản hiệu suất cao</h3>
                           <canvas id="topAccountsChart"></canvas>
                       </div>
                   </div>

                   <!-- Weekly Report Table -->
                   <div class="chart-container">
                       <h3 class="chart-title">Báo cáo tuần chi tiết</h3>
                       <table class="report-table">
                           <thead>
                               <tr>
                                   <th>Seller</th>
                                   <th>Số đơn</th>
                                   <th>Doanh thu</th>
                                   <th>FFM Cost</th>
                                   <th>Lợi nhuận</th>
                                   <th>Margin %</th>
                                   <th>So với tuần trước</th>
                               </tr>
                           </thead>
                           <tbody>
                               <tr>
                                   <td><strong>Trang</strong></td>
                                   <td>127</td>
                                   <td>$2,534</td>
                                   <td>$891</td>
                                   <td class="profit-positive">$1,643</td>
                                   <td>64.8%</td>
                                   <td class="profit-positive">+12%</td>
                               </tr>
                               <tr>
                                   <td><strong>Chi</strong></td>
                                   <td>119</td>
                                   <td>$2,387</td>
                                   <td>$834</td>
                                   <td class="profit-positive">$1,553</td>
                                   <td>65.1%</td>
                                   <td class="profit-positive">+8%</td>
                               </tr>
                               <tr>
                                   <td><strong>Phượng</strong></td>
                                   <td>98</td>
                                   <td>$1,976</td>
                                   <td>$692</td>
                                   <td class="profit-positive">$1,284</td>
                                   <td>65.0%</td>
                                   <td class="profit-positive">+5%</td>
                               </tr>
                           </tbody>
                       </table>
                   </div>

                   <!-- Monthly Summary -->
                   <div class="chart-container">
                       <h3 class="chart-title">Tổng kết tháng 6/2025</h3>
                       <div class="stats-grid">
                           <div class="stat-card success">
                               <div class="stat-header">
                                   <div class="stat-title">Tổng đơn hàng</div>
                                   <div class="stat-icon" style="background: var(--success-color);">
                                       <i class="fas fa-shopping-cart"></i>
                                   </div>
                               </div>
                               <div class="stat-value">2,145</div>
                               <div class="stat-change positive">+15% vs tháng 5</div>
                           </div>
                           <div class="stat-card info">
                               <div class="stat-header">
                                   <div class="stat-title">Tổng doanh thu</div>
                                   <div class="stat-icon" style="background: var(--secondary-color);">
                                       <i class="fas fa-dollar-sign"></i>
                                   </div>
                               </div>
                               <div class="stat-value">$45,678</div>
                               <div class="stat-change positive">+18% vs tháng 5</div>
                           </div>
                           <div class="stat-card warning">
                               <div class="stat-header">
                                   <div class="stat-title">Tổng FFM Cost</div>
                                   <div class="stat-icon" style="background: var(--warning-color);">
                                       <i class="fas fa-truck"></i>
                                   </div>
                               </div>
                               <div class="stat-value">$15,234</div>
                               <div class="stat-change positive">+12% vs tháng 5</div>
                           </div>
                           <div class="stat-card">
                               <div class="stat-header">
                                   <div class="stat-title">Lợi nhuận ròng</div>
                                   <div class="stat-icon" style="background: var(--primary-color);">
                                       <i class="fas fa-chart-line"></i>
                                   </div>
                               </div>
                               <div class="stat-value">$30,444</div>
                               <div class="stat-change positive">+22% vs tháng 5</div>
                           </div>
                       </div>
                   </div>
               </div>
           </div>

           <!-- Settings Section -->
           <div id="settings-section" class="content-section">
               <div class="section-content">
                   <h2 class="chart-title">
                       <i class="fas fa-cog"></i> Cài đặt hệ thống
                   </h2>

                   <div class="settings-grid">
                       <!-- Account Management -->
                       <div class="settings-card">
                           <h3 class="settings-title">Quản lý tài khoản</h3>
                           <div class="form-group">
                               <label class="form-label">Thêm tài khoản mới</label>
                               <input type="text" class="form-input" placeholder="Mã tài khoản (VD: TTUS033)">
                           </div>
                           <div class="form-group">
                               <label class="form-label">Seller</label>
                               <select class="form-select">
                                   <option>Chọn seller</option>
                                   <option>Trang</option>
                                   <option>Phượng</option>
                                   <option>Chi</option>
                               </select>
                           </div>
                           <div class="form-group">
                               <label class="form-label">Tên hiển thị</label>
                               <input type="text" class="form-input" placeholder="Shop name">
                           </div>
                           <button class="btn primary">
                               <i class="fas fa-plus"></i> Thêm tài khoản
                           </button>
                       </div>

                       <!-- Notification Settings -->
                       <div class="settings-card">
                           <h3 class="settings-title">Cài đặt thông báo</h3>
                           <div class="form-group">
                               <label class="form-label">Email thông báo</label>
                               <input type="email" class="form-input" placeholder="admin@company.com">
                           </div>
                           <div class="form-group">
                               <label class="form-label">Thông báo khi</label>
                               <div style="display: flex; flex-direction: column; gap: 8px;">
                                   <label><input type="checkbox" checked> Tài khoản offline</label>
                                   <label><input type="checkbox" checked> Balance giảm bất thường</label>
                                   <label><input type="checkbox"> Ads cost tăng cao</label>
                                   <label><input type="checkbox" checked> Báo cáo tuần</label>
                               </div>
                           </div>
                           <button class="btn success">
                               <i class="fas fa-save"></i> Lưu cài đặt
                           </button>
                       </div>

                       <!-- Data Export -->
                       <div class="settings-card">
                           <h3 class="settings-title">Xuất dữ liệu</h3>
                           <div class="form-group">
                               <label class="form-label">Khoảng thời gian</label>
                               <select class="form-select">
                                   <option>7 ngày qua</option>
                                   <option>30 ngày qua</option>
                                   <option>Tháng này</option>
                                   <option>Tháng trước</option>
                                   <option>Tùy chọn</option>
                               </select>
                           </div>
                           <div class="form-group">
                               <label class="form-label">Định dạng</label>
                               <select class="form-select">
                                   <option>Excel (.xlsx)</option>
                                   <option>CSV (.csv)</option>
                                   <option>PDF (.pdf)</option>
                               </select>
                           </div>
                           <button class="btn secondary">
                               <i class="fas fa-download"></i> Xuất dữ liệu
                           </button>
                       </div>

                       <!-- API Settings -->
                       <div class="settings-card">
                           <h3 class="settings-title">Cài đặt API</h3>
                           <div class="form-group">
                               <label class="form-label">Google Sheets URL</label>
                               <input type="url" class="form-input" placeholder="https://docs.google.com/spreadsheets/d/...">
                           </div>
                           <div class="form-group">
                               <label class="form-label">Tần suất cập nhật</label>
                               <select class="form-select">
                                   <option>Mỗi 5 phút</option>
                                   <option>Mỗi 15 phút</option>
                                   <option>Mỗi 30 phút</option>
                                   <option>Mỗi giờ</option>
                               </select>
                           </div>
                           <button class="btn primary">
                               <i class="fas fa-sync"></i> Test kết nối
                           </button>
                       </div>

                       <!-- Advanced Settings -->
                       <div class="settings-card">
                           <h3 class="settings-title">Cài đặt nâng cao</h3>
                           <div class="form-group">
                               <label class="form-label">Múi giờ</label>
                               <select class="form-select">
                                   <option>GMT+7 (Vietnam)</option>
                                   <option>GMT-5 (US Eastern)</option>
                                   <option>GMT-8 (US Pacific)</option>
                               </select>
                           </div>
                           <div class="form-group">
                               <label class="form-label">Đơn vị tiền tệ</label>
                               <select class="form-select">
                                   <option>USD ($)</option>
                                   <option>VND (₫)</option>
                               </select>
                           </div>
                           <div class="form-group">
                               <label class="form-label">Backup tự động</label>
                               <select class="form-select">
                                   <option>Hàng ngày</option>
                                   <option>Hàng tuần</option>
                                   <option>Hàng tháng</option>
                                   <option>Tắt</option>
                               </select>
                           </div>
                           <button class="btn success">
                               <i class="fas fa-save"></i> Lưu cài đặt
                           </button>
                       </div>

                       <!-- System Info -->
                       <div class="settings-card">
                           <h3 class="settings-title">Thông tin hệ thống</h3>
                           <div style="font-size: 14px; line-height: 1.6;">
                               <p><strong>Phiên bản:</strong> v2.0.0</p>
                               <p><strong>Cập nhật lần cuối:</strong> 22/06/2025</p>
                               <p><strong>Tổng data entries:</strong> 2,547</p>
                               <p><strong>Storage sử dụng:</strong> 45MB / 15GB</p>
                               <p><strong>Uptime:</strong> 99.8%</p>
                           </div>
                           <button class="btn secondary" style="margin-top: 16px;">
                               <i class="fas fa-info-circle"></i> Chi tiết hệ thống
                           </button>
                       </div>
                   </div>
               </div>
           </div>
       </div>
   </div>

   <!-- User Management Modal -->
   <div id="userModal" class="modal">
       <div class="modal-content">
           <div class="modal-header">
               <h3 class="modal-title">Quản lý tài khoản</h3>
               <button class="close-btn" onclick="closeUserModal()">&times;</button>
           </div>
           
           <div class="user-list" id="userList">
               <!-- User list sẽ được render bằng JavaScript -->
           </div>

           <h4 style="margin-bottom: 16px;">Thêm tài khoản mới</h4>
           <form id="addUserForm">
               <div class="form-group">
                   <label class="form-label">Tên đăng nhập</label>
                   <input type="text" id="newUsername" class="form-input" required>
               </div>
               <div class="form-group">
                   <label class="form-label">Mật khẩu</label>
                   <input type="password" id="newPassword" class="form-input" required>
               </div>
               <div class="form-group">
                   <label class="form-label">Tên hiển thị</label>
                   <input type="text" id="newDisplayName" class="form-input" required>
               </div>
               <div class="form-group">
                   <label class="form-label">Vai trò</label>
                   <select id="newRole" class="form-input">
                       <option value="seller">Seller</option>
                       <option value="manager">Manager</option>
                       <option value="admin">Admin</option>
                   </select>
               </div>
               <div class="form-group">
                   <label class="form-label">Seller (nếu là seller)</label>
                   <select id="newSeller" class="form-input">
                       <option value="">Chọn seller</option>
                       <option value="trang">Trang</option>
                       <option value="phuong">Phượng</option>
                       <option value="chi">Chi</option>
                   </select>
               </div>
               <button type="submit" class="login-button">
                   <i class="fas fa-plus"></i> Thêm tài khoản
               </button>
           </form>
       </div>
   </div>

   <!-- Notification Container -->
   <div id="notification" class="notification"></div>

   <script>
       // ===== USER DATABASE & AUTHENTICATION =====
       const defaultUsers = {
           "admin": { 
               password: "admin123", 
               role: "admin", 
               name: "Administrator",
               permissions: ["view_all", "create_users", "settings"] 
           },
           "november_chi": { 
               password: "123", 
               role: "seller", 
               name: "November Chi",
               seller: "chi",
               permissions: ["view_own_data"] 
           },
           "manager1": { 
               password: "manager123", 
               role: "manager", 
               name: "Manager 1",
               permissions: ["view_all"] 
           }
       };

       // Initialize users if not exists
       if (!localStorage.getItem('dashboard_users')) {
           localStorage.setItem('dashboard_users', JSON.stringify(defaultUsers));
       }

       // Current user session
       let currentUser = null;

       // Mock data cho demo
       const mockData = {
           trang: [
               { id: 'TTUS001', name: 'Shop Trang 01', paid: 234, processing: 156, onHold: 890, orders: 12, status: 'active', updated: '14:30' },
               { id: 'TTUS002', name: 'Shop Trang 02', paid: 189, processing: 234, onHold: 567, orders: 8, status: 'active', updated: '14:28' },
               { id: 'TTUS003', name: 'Shop Trang 03', paid: 156, processing: 89, onHold: 445, orders: 5, status: 'warning', updated: '14:25' },
               { id: 'TTUS004', name: 'Shop Trang 04', paid: 298, processing: 178, onHold: 789, orders: 15, status: 'active', updated: '14:32' },
               { id: 'TTUS005', name: 'Shop Trang 05', paid: 176, processing: 145, onHold: 623, orders: 9, status: 'active', updated: '14:29' },
               { id: 'TTUS006', name: 'Shop Trang 06', paid: 0, processing: 0, onHold: 0, orders: 0, status: 'error', updated: 'ERROR' },
               { id: 'TTUS007', name: 'Shop Trang 07', paid: 223, processing: 167, onHold: 512, orders: 11, status: 'active', updated: '14:31' },
               { id: 'TTUS008', name: 'Shop Trang 08', paid: 267, processing: 189, onHold: 734, orders: 13, status: 'active', updated: '14:27' },
               { id: 'TTUS009', name: 'Shop Trang 09', paid: 145, processing: 123, onHold: 456, orders: 7, status: 'active', updated: '14:26' },
               { id: 'TTUS010', name: 'Shop Trang 10', paid: 198, processing: 156, onHold: 589, orders: 10, status: 'active', updated: '14:33' },
               { id: 'TTUS011', name: 'Shop Trang 11', paid: 289, processing: 201, onHold: 823, orders: 16, status: 'active', updated: '14:30' },
               { id: 'TTUS012', name: 'Shop Trang 12', paid: 234, processing: 167, onHold: 678, orders: 12, status: 'active', updated: '14:28' }
           ],
           phuong: [
               { id: 'TTUS013', name: 'Shop Phượng 01', paid: 198, processing: 134, onHold: 567, orders: 9, status: 'active', updated: '14:29' },
               { id: 'TTUS014', name: 'Shop Phượng 02', paid: 245, processing: 178, onHold: 689, orders: 12, status: 'active', updated: '14:31' },
               { id: 'TTUS015', name: 'Shop Phượng 03', paid: 167, processing: 123, onHold: 445, orders: 7, status: 'warning', updated: '14:24' },
               { id: 'TTUS016', name: 'Shop Phượng 04', paid: 223, processing: 156, onHold: 612, orders: 11, status: 'active', updated: '14:32' },
               { id: 'TTUS017', name: 'Shop Phượng 05', paid: 189, processing: 145, onHold: 534, orders: 8, status: 'active', updated: '14:27' },
               { id: 'TTUS018', name: 'Shop Phượng 06', paid: 276, processing: 189, onHold: 723, orders: 14, status: 'active', updated: '14:30' },
               { id: 'TTUS019', name: 'Shop Phượng 07', paid: 156, processing: 112, onHold: 467, orders: 6, status: 'active', updated: '14:26' },
               { id: 'TTUS020', name: 'Shop Phượng 08', paid: 234, processing: 167, onHold: 589, orders: 10, status: 'active', updated: '14:33' },
               { id: 'TTUS021', name: 'Shop Phượng 09', paid: 201, processing: 134, onHold: 512, orders: 9, status: 'active', updated: '14:28' },
               { id: 'TTUS022', name: 'Shop Phượng 10', paid: 145, processing: 98, onHold: 423, orders: 5, status: 'warning', updated: '14:25' }
           ],
           chi: [
               { id: 'TTUS023', name: 'Shop Chi 01', paid: 267, processing: 189, onHold: 734, orders: 13, status: 'active', updated: '14:31' },
               { id: 'TTUS024', name: 'Shop Chi 02', paid: 198, processing: 145, onHold: 567, orders: 9, status: 'active', updated: '14:29' },
               { id: 'TTUS025', name: 'Shop Chi 03', paid: 234, processing: 167, onHold: 623, orders: 11, status: 'active', updated: '14:30' },
               { id: 'TTUS026', name: 'Shop Chi 04', paid: 289, processing: 201, onHold: 789, orders: 15, status: 'active', updated: '14:32' },
               { id: 'TTUS027', name: 'Shop Chi 05', paid: 156, processing: 123, onHold: 456, orders: 7, status: 'active', updated: '14:27' },
               { id: 'TTUS028', name: 'Shop Chi 06', paid: 223, processing: 156, onHold: 612, orders: 10, status: 'active', updated: '14:28' },
               { id: 'TTUS029', name: 'Shop Chi 07', paid: 245, processing: 178, onHold: 689, orders: 12, status: 'active', updated: '14:33' },
               { id: 'TTUS030', name: 'Shop Chi 08', paid: 176, processing: 134, onHold: 523, orders: 8, status: 'warning', updated: '14:26' },
               { id: 'TTUS031', name: 'Shop Chi 09', paid: 201, processing: 145, onHold: 578, orders: 9, status: 'active', updated: '14:29' },
               { id: 'TTUS032', name: 'Shop Chi 10', paid: 189, processing: 112, onHold: 467, orders: 6, status: 'active', updated: '14:25' }
           ]
       };

       // Mock FFM data
       const mockFFMData = [
           { date: '22/06/2025', account: 'TTUS001', orderId: 'TT123456', product: 'Premium T-Shirt', value: 67, ffm: '', profit: 0, status: 'Chưa nhập' },
           { date: '22/06/2025', account: 'TTUS001', orderId: 'TT123457', product: 'Sports Hoodie', value: 45, ffm: 15, profit: 30, status: 'Hoàn thành' },
           { date: '22/06/2025', account: 'TTUS002', orderId: 'TT123458', product: 'Custom Mug', value: 23, ffm: '', profit: 0, status: 'Chưa nhập' },
           { date: '22/06/2025', account: 'TTUS003', orderId: 'TT123459', product: 'Phone Case', value: 89, ffm: '', profit: 0, status: 'Chưa nhập' },
           { date: '21/06/2025', account: 'TTUS001', orderId: 'TT123460', product: 'Baseball Cap', value: 34, ffm: 12, profit: 22, status: 'Hoàn thành' },
           { date: '21/06/2025', account: 'TTUS004', orderId: 'TT123461', product: 'Poster Print', value: 56, ffm: 18, profit: 38, status: 'Hoàn thành' },
           { date: '22/06/2025', account: 'TTUS023', orderId: 'TT123462', product: 'Chi Product 1', value: 78, ffm: '', profit: 0, status: 'Chưa nhập' },
           { date: '22/06/2025', account: 'TTUS024', orderId: 'TT123463', product: 'Chi Product 2', value: 45, ffm: 14, profit: 31, status: 'Hoàn thành' },
       ];

       // ===== AUTHENTICATION FUNCTIONS =====
       function checkExistingSession() {
           const savedSession = localStorage.getItem('dashboard_session');
           if (savedSession) {
               const session = JSON.parse(savedSession);
               const now = new Date().getTime();
               
               if (now - session.timestamp < 24 * 60 * 60 * 1000) {
                   currentUser = session.user;
                   showDashboard();
                   return true;
               }
           }
           return false;
       }

       document.getElementById('loginForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const username = document.getElementById('username').value;
           const password = document.getElementById('password').value;
           const rememberMe = document.getElementById('rememberMe').checked;
           
           if (login(username, password, rememberMe)) {
               showDashboard();
           }
       });

       function login(username, password, remember = false) {
           const users = JSON.parse(localStorage.getItem('dashboard_users'));
           const user = users[username];
           
           if (!user || user.password !== password) {
               showError('Tên đăng nhập hoặc mật khẩu không đúng');
               return false;
           }
           
           currentUser = user;
           currentUser.username = username;
           
           if (remember) {
               const session = {
                   user: currentUser,
                   timestamp: new Date().getTime()
               };
               localStorage.setItem('dashboard_session', JSON.stringify(session));
           }
           
           return true;
       }

       function showDashboard() {
           document.getElementById('loginScreen').style.display = 'none';
           document.getElementById('dashboardScreen').classList.add('active');
           
           document.getElementById('currentUserName').textContent = currentUser.name;
           document.getElementById('currentUserRole').textContent = currentUser.role.toUpperCase();
           
           setupUserPermissions();
           initDashboard();
       }

       function setupUserPermissions() {
           const isAdmin = currentUser.role === 'admin';
           const isSeller = currentUser.role === 'seller';
           const sellerType = currentUser.seller;
           
           document.getElementById('tab-users').style.display = isAdmin ? 'block' : 'none';
           document.getElementById('tab-settings').style.display = isAdmin ? 'block' : 'none';
           
           if (isSeller) {
               document.getElementById('tab-trang').style.display = sellerType === 'trang' ? 'block' : 'none';
               document.getElementById('tab-phuong').style.display = sellerType === 'phuong' ? 'block' : 'none';
               document.getElementById('tab-chi').style.display = sellerType === 'chi' ? 'block' : 'none';
               document.getElementById('tab-reports').style.display = 'none';
               document.getElementById('tab-ffm').style.display = 'none';
           }
       }

       function logout() {
           localStorage.removeItem('dashboard_session');
           currentUser = null;
           
           document.getElementById('dashboardScreen').classList.remove('active');
           document.getElementById('loginScreen').style.display = 'flex';
           
           document.getElementById('loginForm').reset();
           hideError();
       }

       function showError(message) {
           const errorDiv = document.getElementById('errorMessage');
           errorDiv.textContent = message;
           errorDiv.style.display = 'block';
           
           document.getElementById('username').classList.add('error');
           document.getElementById('password').classList.add('error');
       }

       function hideError() {
           document.getElementById('errorMessage').style.display = 'none';
           document.getElementById('username').classList.remove('error');
           document.getElementById('password').classList.remove('error');
       }

       function togglePassword() {
           const passwordInput = document.getElementById('password');
           const passwordIcon = document.getElementById('passwordIcon');
           
           if (passwordInput.type === 'password') {
               passwordInput.type = 'text';
               passwordIcon.className = 'fas fa-eye-slash';
           } else {
               passwordInput.type = 'password';
               passwordIcon.className = 'fas fa-eye';
           }
       }

       document.getElementById('username').addEventListener('input', hideError);
       document.getElementById('password').addEventListener('input', hideError);

       // ===== USER MANAGEMENT FUNCTIONS =====
       function openUserManagement() {
           if (currentUser.role !== 'admin') {
               showNotification('error', 'Bạn không có quyền truy cập chức năng này');
               return;
           }
           
           renderUserList();
           document.getElementById('userModal').classList.add('active');
       }

       function closeUserModal() {
           document.getElementById('userModal').classList.remove('active');
       }

       function renderUserList() {
           const users = JSON.parse(localStorage.getItem('dashboard_users'));
           const userList = document.getElementById('userList');
           
           userList.innerHTML = Object.keys(users).map(username => {
               const user = users[username];
               return `
                   <div class="user-item">
                       <div class="user-item-info">
                           <div class="user-item-name">${user.name} (${username})</div>
                           <div class="user-item-role">${user.role} ${user.seller ? `- ${user.seller}` : ''}</div>
                       </div>
                       ${username !== 'admin' ? `
                           <button class="delete-user-btn" onclick="deleteUser('${username}')">
                               <i class="fas fa-trash"></i>
                           </button>
                       ` : ''}
                   </div>
               `;
           }).join('');
       }

       document.getElementById('addUserForm').addEventListener('submit', function(e) {
           e.preventDefault();
           
           const username = document.getElementById('newUsername').value;
           const password = document.getElementById('newPassword').value;
           const name = document.getElementById('newDisplayName').value;
           const role = document.getElementById('newRole').value;
           const seller = document.getElementById('newSeller').value;
           
           addUser(username, password, name, role, seller);
       });

       function addUser(username, password, name, role, seller) {
           const users = JSON.parse(localStorage.getItem('dashboard_users'));
           
           if (users[username]) {
               showNotification('error', 'Tên đăng nhập đã tồn tại');
               return;
           }
           
           const newUser = {
               password: password,
               role: role,
               name: name,
               permissions: role === 'admin' ? ['view_all', 'create_users', 'settings'] :
                          role === 'manager' ? ['view_all'] : ['view_own_data']
           };
           
           if (seller && role === 'seller') {
               newUser.seller = seller;
           }
           
           users[username] = newUser;
           localStorage.setItem('dashboard_users', JSON.stringify(users));
           
           document.getElementById('addUserForm').reset();
           renderUserList();
           
           showNotification('success', `Đã thêm tài khoản ${username} thành công`);
       }

       function deleteUser(username) {
           if (username === 'admin') {
               showNotification('error', 'Không thể xóa tài khoản admin');
               return;
           }
           
           if (confirm(`Bạn có chắc muốn xóa tài khoản ${username}?`)) {
               const users = JSON.parse(localStorage.getItem('dashboard_users'));
               delete users[username];
               localStorage.setItem('dashboard_users', JSON.stringify(users));
               
               renderUserList();
               showNotification('success', `Đã xóa tài khoản ${username}`);
           }
       }

       // ===== DASHBOARD FUNCTIONS =====
       function createAccountCard(account) {
           return `
               <div class="account-card status-${account.status}" onclick="viewAccountDetails('${account.id}')">
                   <div class="account-header">
                       <div class="account-name">${account.id}</div>
                       <div class="status-indicator ${account.status}"></div>
                   </div>
                   <div class="account-balance">
                       <div class="balance-item">
                           <div class="balance-label">Paid</div>
                           <div class="balance-value">$${account.paid}</div>
                       </div>
                       <div class="balance-item">
                           <div class="balance-label">Processing</div>
                           <div class="balance-value">$${account.processing}</div>
                       </div>
                       <div class="balance-item">
                           <div class="balance-label">On Hold</div>
                           <div class="balance-value">$${account.onHold}</div>
                       </div>
                       <div class="balance-item">
                           <div class="balance-label">Total</div>
                           <div class="balance-value">$${account.paid + account.processing + account.onHold}</div>
                       </div>
                   </div>
                   <div class="account-orders">
                       <i class="fas fa-shopping-cart"></i> ${account.orders} đơn hôm nay
                   </div>
                   <div class="account-updated">
                       Cập nhật: ${account.updated}
                   </div>
               </div>
           `;
       }

       function renderAccounts() {
           const isSeller = currentUser.role === 'seller';
           const sellerType = currentUser.seller;
           
           if (isSeller) {
               // Seller chỉ thấy data của mình
               if (sellerType === 'trang') {
                   document.getElementById('trangAccounts').innerHTML = 
                       mockData.trang.map(createAccountCard).join('');
                   document.getElementById('trangDetailAccounts').innerHTML = 
                       mockData.trang.map(createAccountCard).join('');
               } else if (sellerType === 'phuong') {
                   document.getElementById('phuongAccounts').innerHTML = 
                       mockData.phuong.map(createAccountCard).join('');
                   document.getElementById('phuongDetailAccounts').innerHTML = 
                       mockData.phuong.map(createAccountCard).join('');
               } else if (sellerType === 'chi') {
                   document.getElementById('chiAccounts').innerHTML = 
                       mockData.chi.map(createAccountCard).join('');
                   document.getElementById('chiDetailAccounts').innerHTML = 
                       mockData.chi.map(createAccountCard).join('');
               }
           } else {
               // Admin và Manager thấy tất cả
               document.getElementById('trangAccounts').innerHTML = 
                   mockData.trang.map(createAccountCard).join('');
               document.getElementById('phuongAccounts').innerHTML = 
                   mockData.phuong.map(createAccountCard).join('');
               document.getElementById('chiAccounts').innerHTML = 
                   mockData.chi.map(createAccountCard).join('');
                   
               document.getElementById('trangDetailAccounts').innerHTML = 
                   mockData.trang.map(createAccountCard).join('');
               document.getElementById('phuongDetailAccounts').innerHTML = 
                   mockData.phuong.map(createAccountCard).join('');
               document.getElementById('chiDetailAccounts').innerHTML = 
                   mockData.chi.map(createAccountCard).join('');
           }
       }

       function renderFFMTable() {
           let dataToShow = mockFFMData;
           
           // Filter FFM data based on user role
           if (currentUser.role === 'seller') {
               const sellerAccounts = mockData[currentUser.seller] || [];
               const sellerAccountIds = sellerAccounts.map(acc => acc.id);
               dataToShow = mockFFMData.filter(order => sellerAccountIds.includes(order.account));
           }
           
           const tbody = document.getElementById('ffmTableBody');
           tbody.innerHTML = dataToShow.map(order => `
               <tr>
                   <td>${order.date}</td>
                   <td><strong>${order.account}</strong></td>
                   <td>${order.orderId}</td>
                   <td>${order.product}</td>
                   <td>$${order.value}</td>
                   <td>
                       <input type="number" class="ffm-input" value="${order.ffm}" 
                              onchange="calculateProfit(this, ${order.value})" 
                              placeholder="0.00" step="0.01">
                   </td>
                   <td class="profit-cell ${order.profit > 0 ? 'profit-positive' : order.profit < 0 ? 'profit-negative' : ''}">
                       $<span class="profit-value">${order.profit.toFixed(2)}</span>
                   </td>
                   <td>
                       <span class="status-badge ${order.status === 'Hoàn thành' ? 'success' : 'warning'}">
                           ${order.status}
                       </span>
                   </td>
               </tr>
           `).join('');
       }

       function calculateProfit(input, orderValue) {
           const ffmCost = parseFloat(input.value) || 0;
           const profit = orderValue - ffmCost;
           const profitCell = input.closest('tr').querySelector('.profit-value');
           const profitContainer = input.closest('tr').querySelector('.profit-cell');
           
           profitCell.textContent = profit.toFixed(2);
           
           profitContainer.className = `profit-cell ${profit > 0 ? 'profit-positive' : profit < 0 ? 'profit-negative' : ''}`;
           
           const statusCell = input.closest('tr').querySelector('.status-badge');
           if (ffmCost > 0) {
               statusCell.textContent = 'Hoàn thành';
               statusCell.className = 'status-badge success';
           }
       }

       function switchTab(tabName) {
           document.querySelectorAll('.nav-tab').forEach(tab => {
               tab.classList.remove('active');
           });
           
           event.target.classList.add('active');
           
           document.querySelectorAll('.content-section').forEach(section => {
               section.classList.remove('active');
           });
           
           const sectionId = tabName + '-section';
           const targetSection = document.getElementById(sectionId);
           if (targetSection) {
               targetSection.classList.add('active');
           }

           if (tabName === 'reports') {
               setTimeout(initializeCharts, 100);
           }
       }

       function initializeCharts() {
           // Weekly Performance Chart
           const weeklyCtx = document.getElementById('weeklyChart');
           if (weeklyCtx && !weeklyCtx.chartInstance) {
               weeklyCtx.chartInstance = new Chart(weeklyCtx, {
                   type: 'line',
                   data: {
                       labels: ['T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'],
                       datasets: [{
                           label: 'Doanh thu ($)',
                           data: [1200, 1450, 1300, 1600, 1750, 1400, 1100],
                           borderColor: '#ff0050',
                           backgroundColor: 'rgba(255, 0, 80, 0.1)',
                           tension: 0.4
                       }]
                   },
                   options: {
                       responsive: true,
                       scales: {
                           y: {
                               beginAtZero: true
                           }
                       }
                   }
               });
           }

           // Seller Comparison Chart
           const sellerCtx = document.getElementById('sellerChart');
           if (sellerCtx && !sellerCtx.chartInstance) {
               sellerCtx.chartInstance = new Chart(sellerCtx, {
                   type: 'bar',
                   data: {
                       labels: ['Trang', 'Chi', 'Phượng'],
                       datasets: [{
                           label: 'Lợi nhuận ($)',
                           data: [1643, 1553, 1284],
                           backgroundColor: ['#fbbf24', '#06b6d4', '#8b5cf6']
                       }]
                   },
                   options: {
                       responsive: true,
                       scales: {
                           y: {
                               beginAtZero: true
                           }
                       }
                   }
               });
           }

           // Monthly Trends Chart
           const monthlyCtx = document.getElementById('monthlyChart');
           if (monthlyCtx && !monthlyCtx.chartInstance) {
               monthlyCtx.chartInstance = new Chart(monthlyCtx, {
                   type: 'line',
                   data: {
                       labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6'],
                       datasets: [
                           {
                               label: 'Doanh thu',
                               data: [28000, 32000, 35000, 38000, 39000, 45678],
                               borderColor: '#10b981',
                               backgroundColor: 'rgba(16, 185, 129, 0.1)'
                           },
                           {
                               label: 'Lợi nhuận',
                               data: [18000, 21000, 23000, 25000, 26000, 30444],
                               borderColor: '#ff0050',
                               backgroundColor: 'rgba(255, 0, 80, 0.1)'
                           }
                       ]
                   },
                   options: {
                       responsive: true,
                       scales: {
                           y: {
                               beginAtZero: true
                           }
                       }
                   }
               });
           }

           // Top Accounts Chart
           const topAccountsCtx = document.getElementById('topAccountsChart');
           if (topAccountsCtx && !topAccountsCtx.chartInstance) {
               topAccountsCtx.chartInstance = new Chart(topAccountsCtx, {
                   type: 'doughnut',
                   data: {
                       labels: ['TTUS001', 'TTUS026', 'TTUS011', 'TTUS029', 'TTUS018', 'Khác'],
                       datasets: [{
                           data: [312, 298, 289, 267, 276, 1200],
                           backgroundColor: [
                               '#ff0050', '#00f2ea',
                               '#10b981', '#f59e0b',
                               '#8b5cf6', '#6b7280'
                           ]
                       }]
                   },
                   options: {
                       responsive: true,
                       plugins: {
                           legend: {
                               position: 'bottom'
                           }
                       }
                   }
               });
           }
       }

       // FFM Functions
       function searchOrders() {
           const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
           showNotification('info', `Tìm kiếm đơn hàng: "${searchTerm}"`);
       }

       function importFromExcel() {
           showNotification('info', 'Chức năng import Excel sẽ được phát triển sau');
       }

       function saveAllFFM() {
           const ffmInputs = document.querySelectorAll('.ffm-input');
           let savedCount = 0;
           
           ffmInputs.forEach(input => {
               if (input.value && input.value > 0) {
                   savedCount++;
               }
           });
           
           showNotification('success', `Đã lưu ${savedCount} FFM cost entries`);
       }

       function exportFFMData() {
           showNotification('success', 'Đang xuất dữ liệu FFM...');
       }

       function viewAccountDetails(accountId) {
           showNotification('info', `Xem chi tiết tài khoản: ${accountId}`);
       }

       function showNotification(type, message) {
           const notification = document.getElementById('notification');
           notification.className = `notification ${type}`;
           notification.innerHTML = `
               <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
               ${message}
           `;
           notification.classList.add('show');
           
           setTimeout(() => {
               notification.classList.remove('show');
           }, 3000);
       }

       function updateLastUpdateTime() {
           const now = new Date();
           const formatted = now.toLocaleDateString('vi-VN') + ' - ' + 
                            now.toLocaleTimeString('vi-VN', {hour: '2-digit', minute: '2-digit'});
           document.getElementById('lastUpdate').textContent = formatted;
       }

       function initDashboard() {
           renderAccounts();
           renderFFMTable();
           updateLastUpdateTime();
           
           setInterval(updateLastUpdateTime, 60000);
           
           setTimeout(() => {
               showNotification('success', `Chào mừng ${currentUser.name}! Dashboard đã sẵn sàng.`);
           }, 1000);
       }

       // Auto logout after inactivity (30 minutes)
       let inactivityTimer;
       
       function resetInactivityTimer() {
           clearTimeout(inactivityTimer);
           inactivityTimer = setTimeout(() => {
               showNotification('error', 'Phiên làm việc đã hết hạn. Vui lòng đăng nhập lại.');
               setTimeout(logout, 2000);
           }, 30 * 60 * 1000);
       }

       document.addEventListener('click', resetInactivityTimer);
       document.addEventListener('keypress', resetInactivityTimer);
       document.addEventListener('scroll', resetInactivityTimer);

       // Initialize on page load
       document.addEventListener('DOMContentLoaded', function() {
           if (!checkExistingSession()) {
               document.getElementById('loginScreen').style.display = 'flex';
           }
       });

       // Close modal when clicking outside
       document.getElementById('userModal').addEventListener('click', function(e) {
           if (e.target === this) {
               closeUserModal();
           }
       });

       // Security: Clear sensitive data on page unload
       window.addEventListener('beforeunload', function() {
           if (!document.getElementById('rememberMe').checked) {
               localStorage.removeItem('dashboard_session');
           }
       });

       // Keyboard shortcuts
       document.addEventListener('keydown', function(e) {
           if (e.ctrlKey) {
               switch(e.key) {
                   case '1':
                       e.preventDefault();
                       switchTab('overview');
                       break;
                   case '2':
                       e.preventDefault();
                       if (document.getElementById('tab-ffm').style.display !== 'none') {
                           switchTab('ffm');
                       }
                       break;
                   case '3':
                       e.preventDefault();
                       if (document.getElementById('tab-reports').style.display !== 'none') {
                           switchTab('reports');
                       }
                       break;
               }
           }
       });
   </script>
</body>
</html>